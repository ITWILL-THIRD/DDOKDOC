<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.todoc.hospital.dao.HospitalDAO">
	
	<!-- 동적 처리(승인 상태/가입일자) & 페이징 처리 -->
	<select id="getSignupDatePage" parameterType="map" resultType="HospitalVO">
		SELECT * 
		FROM (
		    SELECT ROWNUM AS R_NUM, J.*
		    FROM (
		        SELECT  H.*,
		                A.ROADADDRESSNAME AS ROADADDRESSNAME, 
		                A.DETAILADDRESS AS DETAILADDRESS,
		                T.OPENTIME AS OPENTIME
		        FROM HOSPITAL H
		        JOIN HOSADDRESS A ON A.HOSIDX = H.HOSIDX
		        JOIN HOSTIME T ON T.HOSIDX = H.HOSIDX
		        <choose>
		        	<when test="searchCondition == 'all'">
		        		WHERE 1 = 1
		        	</when>
		        	<when test="searchCondition == 'startDate' and searchCondition == 'endDate'">
		        		WHERE TO_CHAR(T.CLOSETIME, 'YYYYMMDD') >= #{beginDate}
           				  AND TO_CHAR(T.CLOSETIME, 'YYYYMMDD') <= #{endDate}
		        	</when>
		        	<when test="searchCondition == 'before'">
		        		WHERE H.CONDITION = '승인전'
		        	</when>
		        	<when test="searchCondition == 'after'">
		        		WHERE H.CONDITION = '승인완료'
		        	</when>
		        	<when test="searchCondition == 'payment'">
		        		WHERE H.CONDITION = '결제완료'
		        	</when>
		        </choose>
		        ORDER BY H.HOSIDX DESC
		    ) J
		    <![CDATA[
		    WHERE ROWNUM <= #{end}
		) 
		WHERE R_NUM >= #{begin}
		]]>
	</select>
</mapper>